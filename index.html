<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pratas Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <link rel="icon" href="favicon.jpg" type="image/jpeg">
    <script src="https://www.paypal.com/sdk/js?client-id=Af2JphH-9dx1TEPujfpjDFUSQzIEqOSgm1uAJ7tldWqcX0hSWANU4g2BbT2HTPJN5_Y4t-Q7Czu3fKsl&currency=EUR"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: #fff; }
        
        header { background: #1a1a1a; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ff0844; position: sticky; top: 0; z-index: 1000; }
        .logo { display: flex; align-items: center; gap: 10px; font-size: 24px; font-weight: bold; color: #ff0844; cursor: pointer; }
        .logo img { width: 40px; height: 40px; border-radius: 8px; }
        .cart-btn { background: #ff0844; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .container { max-width: 1100px; margin: 40px auto; padding: 20px; text-align: center; }
        
        .menu-categorias { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .card-categoria { position: relative; height: 180px; border-radius: 12px; overflow: hidden; cursor: pointer; border: 2px solid #333; }
        .card-categoria img { width: 100%; height: 100%; object-fit: cover; opacity: 0.4; transition: 0.3s; }
        .card-categoria:hover img { opacity: 0.7; transform: scale(1.05); }
        .card-categoria h2 { position: absolute; bottom: 15px; left: 15px; font-size: 22px; }

        #areaItens { display: none; }
        .lista-subitens { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .item-clicavel { background: #1a1a1a; border-radius: 10px; overflow: hidden; cursor: pointer; border: 1px solid #333; text-align: left; }
        .item-img { width: 100%; height: 140px; object-fit: cover; border-bottom: 2px solid #ff0844; }
        .item-info { padding: 12px; }

        #adminPanel { display: none; background: #111; padding: 30px; border-radius: 15px; border: 2px solid #ff0844; margin: 20px auto; max-width: 700px; text-align: left; }
        .admin-input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; }
        .btn-admin-save { background: #ff0844; color: white; padding: 14px; border: none; width: 100%; cursor: pointer; font-weight: bold; border-radius: 8px; margin-top: 10px; }
        
        .gestao-lista { margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; max-height: 300px; overflow-y: auto; }
        .gestao-item { display: flex; justify-content: space-between; align-items: center; background: #0a0a0a; padding: 10px; border-radius: 5px; margin-bottom: 8px; border: 1px solid #222; }
        .btn-edit { background: #ffb347; color: #000; padding: 5px 10px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; }
        .btn-del { background: #ff0844; color: #fff; padding: 5px 10px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; }

        #modalCrop { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; justify-content: center; align-items: center; }
        .crop-wrapper { background: #1a1a1a; padding: 25px; border-radius: 15px; max-width: 600px; width: 90%; border: 1px solid #ff0844; box-shadow: 0 0 20px rgba(255,8,68,0.3); }
        .crop-container { width: 100%; height: 350px; background: #000; margin-bottom: 20px; border-radius: 8px; overflow: hidden; }
        .crop-controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        .btn-tool { background: #333; color: white; border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-tool:hover { background: #ff0844; transform: scale(1.1); }

        .sidebar-cart { position: fixed; right: -100%; top: 0; width: 320px; height: 100vh; background: #1a1a1a; border-left: 2px solid #ff0844; z-index: 2000; transition: 0.4s; padding: 20px; display: flex; flex-direction: column; }
        .sidebar-cart.active { right: 0; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 450px; width: 90%; text-align: center; border: 1px solid #ff0844; }

        .animar { animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div onclick="voltarAoMenu()" class="logo">
            <img src="favicon.jpg" alt="Logo">
            <span>Pratas Shop</span>
        </div>
        <button class="cart-btn" onclick="toggleCart()">Carrinho (<span id="cart-count">0</span>)</button>
    </header>

    <div class="container">
        <div id="menuPrincipal" class="animar">
            <h1>PRATAS <span style="color:#ff0844">SHOP</span></h1>
            <div class="menu-categorias">
                </div>
        </div>

        <div id="areaItens" class="animar">
            <button onclick="voltarAoMenu()" style="background:transparent; color:#ff0844; border:1px solid #ff0844; padding:8px 15px; border-radius:5px; cursor:pointer; margin-bottom:20px;">← Voltar</button>
            <h2 id="tituloCategoria" style="color:#ff0844; text-transform: uppercase;"></h2>
            <div id="listaItens" class="lista-subitens"></div>
        </div>

        <div id="adminPanel" class="animar">
            <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="adminTitle" style="color:#ff0844;">Painel Administrativo</h2>
                <button onclick="fecharAdmin()" style="background:transparent; color:#ff0844; border:none; font-size:24px; cursor:pointer;">&times;</button>
            </div>

            <div style="border: 1px solid #333; padding: 15px; border-radius: 10px; margin-bottom: 25px;">
                <h3 style="color:#ff0844; margin-bottom: 10px;">Editar Categorias</h3>
                <select id="selCatEditar" class="admin-input">
                    <option value="streaming">Streaming</option>
                    <option value="games">Games</option>
                    <option value="social">Social</option>
                </select>
                <input type="text" id="novoNomeCat" class="admin-input" placeholder="Novo Nome">
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <input type="file" id="imgCatFile" hidden accept="image/*" onchange="iniciarCropCat(this.files[0])">
                    <button onclick="document.getElementById('imgCatFile').click()" style="flex:1; background:#333; color:white; border:1px solid #ff0844; padding:10px; border-radius:5px; cursor:pointer;">Imagem do PC</button>
                    <button onclick="salvarAlteracaoCategoria()" style="flex:1; background:#ff0844; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer; font-weight:bold;">Guardar Categoria</button>
                </div>
            </div>

            <hr style="border:0; border-top:1px solid #333; margin-bottom:25px;">
            
            <h3 style="color:#ff0844; margin-bottom: 10px;">Gerir Produto</h3>
            <input type="hidden" id="editId">
            <input type="text" id="admNome" class="admin-input" placeholder="Nome do Produto">
            <input type="text" id="admDesc" class="admin-input" placeholder="Descrição">
            <input type="number" id="admPreco" class="admin-input" placeholder="Preço (€)" step="0.01">
            <select id="admCat" class="admin-input">
                <option value="streaming">Streaming</option>
                <option value="games">Games</option>
                <option value="social">Social</option>
            </select>
            
            <div style="border: 1px dashed #444; padding: 20px; text-align: center; border-radius: 10px; margin: 15px 0;">
                <input type="file" id="admImgFile" hidden accept="image/*" onchange="iniciarCrop(this.files[0])">
                <button onclick="document.getElementById('admImgFile').click()" style="background:#ff0844; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">Escolher e Recortar Imagem</button>
                <div id="mini-preview" style="display:none; margin-top:15px;">
                    <img id="imgPre" style="width:100px; height:100px; object-fit:cover; border:2px solid #ff0844; border-radius:8px;">
                </div>
            </div>
            
            <button class="btn-admin-save" id="btnSalvar" onclick="salvarProduto()">GUARDAR PRODUTO</button>
            <div class="gestao-lista" id="listaGestao"></div>
        </div>
    </div>

    <div id="modalCrop">
        <div class="crop-wrapper">
            <h2 style="margin-bottom: 20px; color: #ff0844; text-align: center;">Ajustar Imagem</h2>
            <div class="crop-container">
                <img id="imageToCrop">
            </div>
            <div class="crop-controls">
                <button class="btn-tool" onclick="cropper.rotate(-90)" title="Rodar Esquerda"><i class="fas fa-undo"></i></button>
                <button class="btn-tool" onclick="cropper.zoom(0.1)" title="Zoom In"><i class="fas fa-search-plus"></i></button>
                <button class="btn-tool" onclick="cropper.zoom(-0.1)" title="Zoom Out"><i class="fas fa-search-minus"></i></button>
                <button class="btn-tool" onclick="cropper.rotate(90)" title="Rodar Direita"><i class="fas fa-redo"></i></button>
            </div>
            <div style="display:flex; gap: 10px;">
                <button onclick="confirmarCrop()" style="flex:2; background:#ff0844; color:white; border:none; padding:15px; border-radius:8px; font-weight:bold; cursor:pointer;">APLICAR RECORTE</button>
                <button onclick="cancelarCrop()" style="flex:1; background:#333; color:white; border:none; padding:15px; border-radius:8px; cursor:pointer;">CANCELAR</button>
            </div>
        </div>
    </div>

    <div id="sidebarCart" class="sidebar-cart">
        <h2 style="color:#ff0844; margin-bottom:20px;">Carrinho</h2>
        <div id="cart-items" style="flex-grow:1; overflow-y:auto;"></div>
        <div style="padding-top:15px; border-top:1px solid #333;">
            <p style="font-size:18px; margin-bottom:15px;">Total: <span id="cart-total" style="color:#ff0844; font-weight:bold;">€0.00</span></p>
            <input type="text" id="discordUser" placeholder="Seu Discord @User" style="width:100%; padding:10px; background:#000; border:1px solid #333; color:white; margin-bottom:15px;">
            <div id="paypal-button-container"></div>
            <button onclick="toggleCart()" style="width:100%; background:transparent; border:none; color:#666; margin-top:10px; cursor:pointer;">Fechar</button>
        </div>
    </div>

    <div id="modalDetalhe" class="modal">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:24px;" onclick="fecharModal()">&times;</span>
            <div id="modalIcone"></div>
            <h2 id="modalNome" style="margin-top:10px;"></h2>
            <p id="modalDesc" style="color:#888; margin:10px 0;"></p>
            <h1 id="modalPreco" style="color:#ff0844;"></h1>
            <button class="btn-admin-save" onclick="adicionarAoCarrinho()">ADICIONAR AO CARRINHO</button>
        </div>
    </div>

    <script>
        let produtos = JSON.parse(localStorage.getItem('pratas_stock')) || [];
        let configCats = JSON.parse(localStorage.getItem('pratas_cats')) || {
            streaming: { nome: "STREAMING", img: "https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=500" },
            games: { nome: "GAMES", img: "https://images.unsplash.com/photo-1542751371-adc38448a05e?w=500" },
            social: { nome: "SOCIAL", img: "https://images.unsplash.com/photo-1614102073832-030967418971?w=500" }
        };

        let carrinho = [];
        let cropper = null;
        let imagemFinal = null;
        let imagemCatFinal = null;
        let produtoAtual = null;
        let modoCrop = "produto";

        // --- ACESSO ADMIN ---
        let seq = "";
        window.addEventListener("keydown", (e) => {
            seq += e.key.toUpperCase();
            if (seq.includes("DAS")) {
                seq = "";
                if(prompt("Password Admin:") === "AdminPratasShop") {
                    document.getElementById('adminPanel').style.display = 'block';
                    atualizarListaGestao();
                }
            }
        });

        function fecharAdmin() { document.getElementById('adminPanel').style.display = 'none'; resetForm(); }

        // --- LÓGICA DE RECORTE (CROP) ---
        function iniciarCrop(file) {
            if (!file) return;
            modoCrop = "produto";
            processarFicheiroCrop(file);
        }

        function iniciarCropCat(file) {
            if (!file) return;
            modoCrop = "categoria";
            processarFicheiroCrop(file);
        }

        function processarFicheiroCrop(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imgElement = document.getElementById('imageToCrop');
                imgElement.src = e.target.result;
                document.getElementById('modalCrop').style.display = 'flex';
                if (cropper) cropper.destroy();
                cropper = new Cropper(imgElement, {
                    aspectRatio: modoCrop === "produto" ? 1 : 16 / 9, 
                    viewMode: 2, dragMode: 'move', autoCropArea: 1, imageSmoothingQuality: 'high'
                });
            };
            reader.readAsDataURL(file);
        }

        function confirmarCrop() {
            const canvas = cropper.getCroppedCanvas({ width: 600, height: 600, imageSmoothingQuality: 'high' });
            const dataUrl = canvas.toDataURL("image/jpeg", 0.9);
            
            if (modoCrop === "produto") {
                imagemFinal = dataUrl;
                document.getElementById('imgPre').src = imagemFinal;
                document.getElementById('mini-preview').style.display = 'block';
            } else {
                imagemCatFinal = dataUrl;
            }
            document.getElementById('modalCrop').style.display = 'none';
        }

        function cancelarCrop() {
            document.getElementById('modalCrop').style.display = 'none';
        }

        // --- GESTÃO DE CATEGORIAS ---
        function salvarAlteracaoCategoria() {
            const id = document.getElementById('selCatEditar').value;
            const novoNome = document.getElementById('novoNomeCat').value;
            if (novoNome) configCats[id].nome = novoNome.toUpperCase();
            if (imagemCatFinal) configCats[id].img = imagemCatFinal;
            
            localStorage.setItem('pratas_cats', JSON.stringify(configCats));
            alert("Categoria atualizada!");
            renderizarCategorias();
            imagemCatFinal = null;
            document.getElementById('novoNomeCat').value = "";
        }

        function renderizarCategorias() {
            const container = document.querySelector('.menu-categorias');
            container.innerHTML = Object.keys(configCats).map(id => `
                <div class="card-categoria" onclick="abrirCategoria('${id}')">
                    <img src="${configCats[id].img}" alt="${configCats[id].nome}">
                    <h2>${configCats[id].nome}</h2>
                </div>
            `).join('');
        }

        // --- GESTÃO DE PRODUTOS ---
        function salvarProduto() {
            const id = document.getElementById('editId').value;
            const nome = document.getElementById('admNome').value;
            const preco = parseFloat(document.getElementById('admPreco').value);
            const desc = document.getElementById('admDesc').value;
            const cat = document.getElementById('admCat').value;
            if(!nome || !preco || !imagemFinal) return alert("Preencha Nome, Preço e Imagem!");
            if(id) {
                const index = produtos.findIndex(p => p.id == id);
                produtos[index] = { id: parseInt(id), nome, preco, desc, img: imagemFinal, categoria: cat };
            } else {
                produtos.push({ id: Date.now(), nome, preco, desc, img: imagemFinal, categoria: cat });
            }
            localStorage.setItem('pratas_stock', JSON.stringify(produtos));
            alert("Produto guardado!");
            resetForm();
            atualizarListaGestao();
        }

        function editarProduto(id) {
            const p = produtos.find(p => p.id == id);
            document.getElementById('editId').value = p.id;
            document.getElementById('admNome').value = p.nome;
            document.getElementById('admPreco').value = p.preco;
            document.getElementById('admDesc').value = p.desc;
            document.getElementById('admCat').value = p.categoria;
            imagemFinal = p.img;
            document.getElementById('imgPre').src = p.img;
            document.getElementById('mini-preview').style.display = 'block';
            document.getElementById('btnSalvar').innerText = "ATUALIZAR PRODUTO";
        }

        function apagarProduto(id) {
            if(confirm("Eliminar este produto?")) {
                produtos = produtos.filter(p => p.id != id);
                localStorage.setItem('pratas_stock', JSON.stringify(produtos));
                atualizarListaGestao();
            }
        }

        function atualizarListaGestao() {
            const container = document.getElementById('listaGestao');
            container.innerHTML = produtos.map(p => `
                <div class="gestao-item">
                    <span>${p.nome}</span>
                    <div>
                        <button class="btn-edit" onclick="editarProduto(${p.id})">Editar</button>
                        <button class="btn-del" onclick="apagarProduto(${p.id})">X</button>
                    </div>
                </div>
            `).join('');
        }

        function resetForm() {
            document.getElementById('editId').value = "";
            document.getElementById('admNome').value = "";
            document.getElementById('admPreco').value = "";
            document.getElementById('admDesc').value = "";
            document.getElementById('mini-preview').style.display = 'none';
            document.getElementById('btnSalvar').innerText = "GUARDAR PRODUTO";
            imagemFinal = null;
        }

        // --- LOJA E CARRINHO ---
        function abrirCategoria(cat) {
            document.getElementById('menuPrincipal').style.display = 'none';
            document.getElementById('areaItens').style.display = 'block';
            document.getElementById('tituloCategoria').innerText = configCats[cat].nome;
            const filtrados = produtos.filter(p => p.categoria === cat);
            document.getElementById('listaItens').innerHTML = filtrados.map(p => `
                <div class="item-clicavel" onclick="abrirDetalhe(${p.id})">
                    <img src="${p.img}" class="item-img">
                    <div class="item-info"><h3>${p.nome}</h3><span>€${p.preco.toFixed(2)}</span></div>
                </div>`).join('') || "<p>Nenhum item nesta categoria.</p>";
        }

        function voltarAoMenu() { document.getElementById('menuPrincipal').style.display = 'block'; document.getElementById('areaItens').style.display = 'none'; }

        function abrirDetalhe(id) {
            const p = produtos.find(item => item.id == id);
            produtoAtual = p;
            document.getElementById('modalNome').innerText = p.nome;
            document.getElementById('modalDesc').innerText = p.desc;
            document.getElementById('modalPreco').innerText = `€${p.preco.toFixed(2)}`;
            document.getElementById('modalIcone').innerHTML = `<img src="${p.img}" style="width:100%; height:180px; object-fit:cover; border-radius:10px;">`;
            document.getElementById('modalDetalhe').style.display = 'flex';
        }

        function fecharModal() { document.getElementById('modalDetalhe').style.display = 'none'; }
        function toggleCart() { 
            document.getElementById('sidebarCart').classList.toggle('active'); 
            if(document.getElementById('sidebarCart').classList.contains('active')) renderPaypal(); 
        }
        function adicionarAoCarrinho() { carrinho.push(produtoAtual); atualizarCarrinhoUI(); fecharModal(); toggleCart(); }

        function atualizarCarrinhoUI() {
            let total = 0;
            document.getElementById('cart-count').innerText = carrinho.length;
            document.getElementById('cart-items').innerHTML = carrinho.map((i, idx) => {
                total += i.preco;
                return `<div style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:center;">
                    <span>${i.nome}</span>
                    <div>
                        <span style="color:#ff0844; margin-right:10px;">€${i.preco.toFixed(2)}</span>
                        <button onclick="removerDoCarrinho(${idx})" style="background:none; border:none; color:grey; cursor:pointer;">&times;</button>
                    </div>
                </div>`;
            }).join('');
            document.getElementById('cart-total').innerText = `€${total.toFixed(2)}`;
        }

        function removerDoCarrinho(index) {
            carrinho.splice(index, 1);
            atualizarCarrinhoUI();
            if(carrinho.length === 0) document.getElementById('paypal-button-container').innerHTML = '';
            else renderPaypal();
        }

        function renderPaypal() {
            document.getElementById('paypal-button-container').innerHTML = '';
            if(carrinho.length === 0) return;
            paypal.Buttons({
                createOrder: (data, actions) => {
                    if(!document.getElementById('discordUser').value) return alert("Insira o seu Discord para entrega!");
                    return actions.order.create({ purchase_units: [{ amount: { value: document.getElementById('cart-total').innerText.replace('€','') } }] });
                },
                onApprove: (data, actions) => actions.order.capture().then(() => { 
                    alert("Compra efetuada com sucesso!"); 
                    carrinho = []; atualizarCarrinhoUI(); toggleCart(); 
                })
            }).render('#paypal-button-container');
        }

        // Iniciar categorias ao carregar
        window.onload = renderizarCategorias;
    </script>
</body>
</html>
